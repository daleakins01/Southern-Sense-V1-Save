---
layout: layout
title: Southern Sense - Hand Poured Luxury Candles
---

<script type="module">
    import { db, collection, query, where, getDocs } from '/firebase-loader.js';
    import { addToCart } from '/src/cart.js';

    // --- DOM Elements ---
    const featuredProductLoader = document.getElementById('featured-product-loader');
    const featuredProductSection = document.getElementById('featured-product-section');
    const heroImage = document.getElementById('hero-image');
    const productTitle = document.getElementById('product-title');
    const productPrice = document.getElementById('product-price');
    const shortDescription = document.getElementById('short-description');
    const productLink = document.getElementById('product-link');
    const productUrlInput = document.getElementById('product-url');
    const buyButton = document.getElementById('buy-button');
    const outOfStockMessage = document.getElementById('out-of-stock-message');
    const featuredMessage = document.getElementById('featured-message');
    
    let featuredProduct = null; // Store product data globally for use with the Add to Cart button

    /**
     * Renders the out of stock state or an error state.
     * @param {string} message - The message to display.
     */
    function renderUnavailable(message) {
        featuredProductLoader.classList.add('hidden');
        featuredProductSection.classList.remove('hidden');
        
        // Hide commerce elements
        buyButton.classList.add('hidden');
        productPrice.classList.add('hidden');
        
        // Show an alternative message
        productTitle.textContent = "Luxury Awaits";
        outOfStockMessage.classList.remove('hidden');
        outOfStockMessage.textContent = message;
        shortDescription.textContent = "Explore our full collection and find your next signature scent.";
        productLink.href = "/shop/";
        productLink.textContent = "Shop All Candles";
        featuredMessage.classList.add('hidden'); // Hide the featured badge if content fails
    }

    /**
     * Fetches and displays the single featured product.
     */
    async function loadFeaturedProduct() {
        featuredProductLoader.classList.remove('hidden');
        featuredProductSection.classList.add('hidden');

        try {
            // 1. Query Firestore for the product where featured is true
            const productsRef = collection(db, 'products');
            const q = query(productsRef, where('featured', '==', true));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                renderUnavailable("The featured product is currently being updated or is not set.");
                return;
            }

            // 2. Process the featured product (we assume only one product is set to featured)
            const docSnap = querySnapshot.docs[0];
            const data = docSnap.data();
            featuredProduct = {
                id: data.id,
                name: data.name,
                // CRITICAL CHECK: Ensure price is correctly read and parsed
                price: parseFloat(data.price), 
                stock: parseInt(data.stock, 10) || 0, // Ensure stock is an integer
                imageUrl: `/src/${data.imageUrl}`, // Prepend path for local file structure
                shortDescription: data.shortDescription
            };

            // 3. Update DOM with product data
            productTitle.textContent = featuredProduct.name;
            productPrice.textContent = `$${featuredProduct.price.toFixed(2)}`;
            shortDescription.textContent = featuredProduct.shortDescription;
            productLink.href = `/product/?id=${featuredProduct.id}`;
            heroImage.src = featuredProduct.imageUrl;
            heroImage.alt = featuredProduct.name;

            // Store ID for quick navigation/cart actions
            productUrlInput.value = featuredProduct.id;

            // 4. Handle Stock Status
            if (featuredProduct.stock > 0) {
                // In Stock: Show Buy Button, hide Out of Stock message
                buyButton.classList.remove('hidden', 'opacity-50', 'cursor-not-allowed');
                buyButton.disabled = false;
                outOfStockMessage.classList.add('hidden');
            } else {
                // Out of Stock: Disable Buy Button, show message
                buyButton.classList.add('hidden'); // Hide the buy button entirely
                buyButton.disabled = true;
                outOfStockMessage.classList.remove('hidden');
                outOfStockMessage.textContent = "Currently Sold Out. View details to sign up for stock alerts!";
            }

            // 5. Success: Show the content
            featuredProductLoader.classList.add('hidden');
            featuredProductSection.classList.remove('hidden');
            featuredMessage.classList.remove('hidden'); // Ensure the "FEATURED" badge shows
            
        } catch (error) {
            console.error("CRITICAL ERROR: Failed to load featured product:", error);
            // Show a specific error based on the root cause being Firebase/Network
            renderUnavailable("Database Connection Error. Please verify Firebase Project ID.");
        }
    }

    /**
     * Handles the click event for the Add to Cart button.
     */
    function handleAddToCart() {
        if (!featuredProduct || featuredProduct.stock <= 0) {
            return; // Prevent action if product is null or out of stock
        }
        
        // Pass the product details to the global cart logic
        addToCart(
            featuredProduct.id, 
            featuredProduct.name, 
            featuredProduct.price, 
            featuredProduct.imageUrl
        );
    }

    // --- Initialization ---

    document.addEventListener('DOMContentLoaded', () => {
        // Load the featured product data
        loadFeaturedProduct();
        
        // Attach event listener for the Add to Cart button
        buyButton.addEventListener('click', handleAddToCart);
    });

</script>

<main class="min-h-screen">
    
    <section class="relative bg-parchment/70 pt-20 pb-20 md:pt-32 md:pb-32 overflow-hidden">
        
        <div class="absolute inset-0 z-0 bg-cover bg-center opacity-30" 
             style="background-image: url('/src/background-parchment.webp');">
        </div>

        <div class="container mx-auto px-4 relative z-10">
            <div id="featured-product-loader" class="flex justify-center items-center h-64">
                <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-burnt-orange"></div>
            </div>

            <div id="featured-product-section" class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center hidden">
                
                <div class="order-2 lg:order-1 relative p-4 bg-white rounded-xl shadow-2xl">
                    <span id="featured-message" class="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-1/2 px-4 py-1 bg-burnt-orange text-parchment text-xs font-bold uppercase tracking-wider rounded-full shadow-lg hidden">
                        FEATURED SCENT
                    </span>
                    <img id="hero-image" src="/src/aloha-luxe-candle.webp" alt="Featured Southern Sense Candle" 
                         class="w-full h-auto object-cover rounded-lg">
                </div>

                <div class="order-1 lg:order-2">
                    <p class="text-sm font-semibold uppercase tracking-wider text-stone mb-2">LIMITED TIME OFFER</p>
                    <h1 id="product-title" class="text-6xl font-playfair text-charcoal mb-4 leading-tight">
                        Aloha Luxe
                    </h1>
                    
                    <p id="short-description" class="text-xl text-stone mb-6">
                        An exotic escape with notes of fresh coconut and tropical blooms.
                    </p>

                    <p id="product-price" class="text-3xl font-bold text-burnt-orange mb-8">
                        $20.00
                    </p>
                    
                    <p id="out-of-stock-message" class="text-lg text-red-600 font-semibold mb-6 hidden">
                        </p>

                    <div class="flex flex-col sm:flex-row gap-4">
                        <input type="hidden" id="product-url" value="">
                        <button id="buy-button" 
                                class="w-full sm:w-auto px-10 py-4 bg-burnt-orange text-parchment font-bold text-lg rounded-lg shadow-xl hover:bg-burnt-orange/80 transition duration-300">
                            Add to Cart
                        </button>
                        <a id="product-link" href="#"
                           class="w-full sm:w-auto px-10 py-4 text-center border-2 border-stone text-charcoal font-semibold text-lg rounded-lg hover:bg-stone/10 transition duration-300">
                            View Details
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container mx-auto px-4 py-16 text-center">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
            <div class="p-6">
                <h3 class="text-2xl font-playfair text-charcoal mb-3">Hand-Poured Luxury</h3>
                <p class="text-stone">Every candle is meticulously hand-poured in small batches, guaranteeing a flawless, slow burn and maximum scent throw.</p>
            </div>
            <div class="p-6">
                <h3 class="text-2xl font-playfair text-charcoal mb-3">Find Your Signature Scent</h3>
                <p class="text-stone">Take our quick Scent Quiz to discover the perfect fragrance family tailored to your preferences.</p>
                <a href="/scent-quiz.html" class="text-burnt-orange font-semibold hover:underline mt-2 inline-block">Start Quiz &rarr;</a>
            </div>
            <div class="p-6">
                <h3 class="text-2xl font-playfair text-charcoal mb-3">Conscious Consumption</h3>
                <p class="text-stone">Learn about our Refill Program designed to reduce waste and keep your favorite vessels in circulation.</p>
                <a href="/refill-program.html" class="text-burnt-orange font-semibold hover:underline mt-2 inline-block">Learn More &rarr;</a>
            </div>
        </div>
    </section>

    <section class="bg-charcoal text-parchment py-20">
        <div class="container mx-auto px-4 text-center max-w-3xl">
            <h2 class="text-5xl font-playfair mb-4">Master Your Olfactory Journey</h2>
            <p class="text-stone text-lg mb-8">Dive into our Glossary to explore the full depth of our fragrance notes and learn how scent families harmonize.</p>
            <a href="/scent-glossary.html" class="px-8 py-4 bg-burnt-orange text-parchment font-bold text-lg rounded-lg shadow-xl hover:bg-burnt-orange/80 transition duration-300">
                Explore the Glossary
            </a>
        </div>
    </section>

</main>