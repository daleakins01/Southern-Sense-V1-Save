---
layout: layout
title: Scent Glossary
---

{% include "page-header.html" with pageTitle: title, headerImage: '/src/candles-header.webp', shortTitle: "Scent Glossary" %}

<main class="container mx-auto p-4 lg:p-8 py-16">

    <div class="max-w-6xl mx-auto bg-white p-8 lg:p-12 rounded-xl shadow-2xl border border-stone/10">

        <div id="loading-state" class="text-center p-12 bg-parchment rounded-xl shadow-lg border border-stone/10">
            <p class="font-playfair text-2xl text-stone">Loading the world of fragrance notes...</p>
            <div class="mt-4 animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-orange mx-auto"></div>
        </div>

        <section id="glossary-section" class="max-w-4xl mx-auto hidden">
            
            <div id="intro-and-pyramid" class="prose max-w-none text-stone font-roboto space-y-8 mb-12 border-b pb-8">
                </div>
            
            <h2 class="font-playfair text-3xl font-bold text-charcoal mb-6 border-b pb-2">Common Terms in Our Collection</h2>
            
            <div id="glossary-terms-container" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                </div>

            <div class="mt-12 text-center">
                <h3 class="font-playfair text-3xl font-bold text-charcoal mb-4">Still need help finding a scent?</h3>
                <a href="/scent-quiz/" class="inline-block py-3 px-8 bg-burnt-orange text-parchment font-bold rounded-lg shadow-xl hover:bg-amber-700 transition duration-150">
                    Take the Scent Quiz
                </a>
            </div>
        </section>

    </div> </main>

<script type="module">
    // FIX: Corrected import path to include /src/ directory
    import { db, doc, getDoc } from '/src/firebase-loader.js'; 

    // --- DOM Elements ---
    const loadingState = document.getElementById('loading-state');
    const glossarySection = document.getElementById('glossary-section');
    const introAndPyramidContainer = document.getElementById('intro-and-pyramid');
    const glossaryTermsContainer = document.getElementById('glossary-terms-container');


    /**
     * Helper to parse the plain text glossary content into structured HTML.
     * This relies on the specific formatting of the data in the Firestore document.
     */
    function parseAndRenderGlossary(rawText) {
        // Split the text into the two main sections: Intro/Pyramid and Common Terms
        const parts = rawText.split('\n\nCommon Terms in Our Collection\n\n');
        const introSection = parts[0] || '';
        const termsSection = parts[1] || '';

        // --- 1. Render Introduction and Note Pyramid ---
        let introHtml = '';
        
        // Convert double line breaks into paragraphs or line breaks for readability
        const paragraphs = introSection.split('\n\n');
        
        paragraphs.forEach(p => {
            const trimmedP = p.trim();
            if (trimmedP.includes(':')) {
                // Handle the Top/Middle/Base Notes as a definition list for structure
                if (trimmedP.includes('Top Notes:') || trimmedP.includes('Middle Notes:') || trimmedP.includes('Base Notes:')) {
                    const [term, definition] = trimmedP.split(':', 2);
                    introHtml += `<dl class="mt-3"><dt class="font-semibold text-burnt-orange">${term.trim()}:</dt><dd class="text-stone text-sm ml-4">${definition.trim()}</dd></dl>`;
                } else if (trimmedP.includes('Understanding Fragrance Notes')) {
                    introHtml += `<h3 class="text-2xl font-playfair text-charcoal mb-4">${trimmedP}</h3>`;
                } else if (trimmedP.includes('A Guide to Our Scent Notes')) {
                    introHtml += `<h2 class="text-4xl font-playfair text-charcoal mb-4">${trimmedP}</h2><p class="text-lg text-stone">Navigating the world of fragrance can be tricky! Here is a simple guide to the terms we use to describe our scents.</p>`;
                }
            } else if (trimmedP) {
                introHtml += `<p class="text-lg text-stone">${trimmedP}</p>`;
            }
        });
        
        introAndPyramidContainer.innerHTML = introHtml;

        // --- 2. Render Glossary Terms as Cards ---
        let termsHtml = '';
        
        // Split the terms section by double line break to get individual term definitions
        const termDefinitions = termsSection.split('\n\n').filter(t => t.includes(':'));

        termDefinitions.forEach(td => {
            const [term, definition] = td.split(':', 2);
            if (term && definition) {
                termsHtml += `
                    <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-burnt-orange/50 hover:shadow-xl transition duration-300">
                        <h3 class="font-bold text-xl font-playfair text-burnt-orange mb-2">${term.trim()}</h3>
                        <p class="text-sm text-charcoal">${definition.trim()}</p>
                    </div>
                `;
            }
        });
        
        glossaryTermsContainer.innerHTML = termsHtml;
    }


    /**
     * Loads dynamic content for the Scent Glossary page from Firestore.
     */
    async function loadGlossaryContent() {
        console.log("Scent Glossary Page: Loading content from Firestore...");
        
        // Ensure loading state is visible initially
        loadingState.classList.remove('hidden');
        glossarySection.classList.add('hidden');

        try {
            // Document reference for the 'scent-glossary' page content
            // CRITICAL FIX: The CMS document name is 'scent-glossary' based on other CMS files.
            const docRef = doc(db, "siteContent", "scent-glossary");
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                
                // CRITICAL FIX: Instead of raw injection, parse the content into the new structure
                if (data.glossaryContent) {
                    parseAndRenderGlossary(data.glossaryContent);
                } else {
                    introAndPyramidContainer.innerHTML = `<p class="text-red-600">Glossary content is empty. Please update the CMS.</p>`;
                }

                // Success: Hide loading, show content
                loadingState.classList.add('hidden');
                glossarySection.classList.remove('hidden');

            } else {
                console.warn("Scent Glossary Page: Document 'siteContent/scent-glossary' does not exist.");
                loadingState.innerHTML = `<p class="font-playfair text-2xl text-red-600">Error: Glossary configuration document not found.</p>`;
            }
        } catch (error) {
            console.error("Error fetching Scent Glossary content:", error);
            loadingState.innerHTML = `<p class="font-playfair text-2xl text-red-600">Error loading content: ${error.message}</p>`;
        }
    }

    document.addEventListener('DOMContentLoaded', loadGlossaryContent);

; // DEFENSIVE SEMICOLON: Added to absorb potential file truncation errors.
</script>