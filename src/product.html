---
layout: layout.html
title: "Product - Southern Sense"
description: "View details for our hand-poured soy wax candles and melts."
---

<!-- 
  This page dynamically loads a single product's details
  based on a URL query parameter (e.g., /product/?id=PRODUCT_ID).
-->

<div class="bg-parchment py-12 md:py-20">
    <div class="container mx-auto px-4">

        <!-- Loading State -->
        <!-- This will be hidden once the product data is loaded -->
        <div id="product-loader" class="text-center py-20">
            <p class="text-2xl font-playfair text-stone animate-pulse">Loading Product...</p>
        </div>

        <!-- Error Message -->
        <!-- This will be shown if the product ID is missing or invalid -->
        <div id="product-error" class="text-center py-20 hidden">
            <h1 class="text-4xl font-playfair text-charcoal mb-4">Product Not Found</h1>
            <p class="text-lg text-stone mb-8">
                We're sorry, but we couldn't find the product you're looking for.
            </p>
            <a href="/shop/" class="bg-burnt-orange text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-charcoal transition-all duration-300">
                Back to Shop
            </a>
        </div>

        <!-- Product Content -->
        <!-- This container is hidden by default and shown after data loads -->
        <div id="product-content" class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-start hidden">
            
            <!-- Column 1: Product Image -->
            <div class="w-full">
                <img id="product-image" 
                     src="https://placehold.co/600x600/FBF9F6/3D352E?text=Loading..." 
                     alt="Product image"
                     class="w-full h-auto object-cover rounded-lg shadow-lg">
            </div>

            <!-- Column 2: Product Details -->
            <div>
                <!-- Product Name -->
                <h1 id="product-name" class="text-4xl md:text-5xl font-playfair text-charcoal mb-4">
                    Loading...
                </h1>
                
                <!-- Product Price -->
                <p id="product-price" class="text-3xl font-roboto text-charcoal font-medium mb-6">
                    $0.00
                </p>

                <!-- Product Short Description -->
                <p id="product-short-desc" class="text-lg text-stone mb-6">
                    Loading...
                </p>
                
                <!-- Add to Cart Form -->
                <div id="add-to-cart-form" class="flex items-center gap-4 mb-6">
                    <!-- Quantity Selector -->
                    <div class="quantity-selector">
                        <label for="quantity" class="sr-only">Quantity</label>
                        <input id="quantity" 
                               type="number" 
                               value="1" 
                               min="1" 
                               max="99" 
                               class="w-20 p-3 border border-stone/50 rounded-lg text-center font-semibold text-charcoal focus:ring-2 focus:ring-burnt-orange focus:border-transparent">
                    </div>
                    
                    <!-- Add to Cart Button -->
                    <button id="add-to-cart-button" 
                            class="flex-grow bg-burnt-orange text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-charcoal transition-all duration-300 disabled:bg-stone/50 disabled:cursor-not-allowed">
                        Add to Cart
                    </button>
                </div>
                
                <!-- Confirmation Message -->
                <p id="add-to-cart-confirmation" class="text-green-700 font-semibold text-center mb-6 hidden">
                    âœ“ Added to cart!
                </p>

                <!-- Full Product Description -->
                <div class="prose max-w-none text-stone">
                    <h3 class="text-xl font-playfair text-charcoal mb-2">Description</h3>
                    <!-- The long description (which contains HTML) will be injected here -->
                    <div id="product-long-desc">
                        <p>Loading...</p>
                    </div>
                </div>

                <!-- Product Details (Scent Notes, etc.) -->
                <div class="mt-6 border-t border-stone/30 pt-6">
                    <h3 class="text-xl font-playfair text-charcoal mb-4">Scent Profile</h3>
                    <ul class="text-stone space-y-2">
                        <li>
                            <strong>Scent Notes:</strong> 
                            <span id="product-scent-notes">Loading...</span>
                        </li>
                        <li>
                            <strong>Scent Family:</strong> 
                            <span id="product-scent-family">Loading...</span>
                        </li>
                        <li>
                            <strong>Strength:</strong> 
                            <span id="product-strength">Loading...</span> / 5
                        </li>
                    </ul>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- 
  JavaScript for this page.
  It fetches the product data from Firestore using the ID
  from the URL and populates the content.
-->
<script type="module">
    // Import from Firebase SDK
    import { db } from '/firebase-loader.js';
    import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    // Import from our local cart script
    // This is available because we added it in layout.html
    import { addToCart } from '/cart.js';

    // Get all the HTML elements we need to update
    const loader = document.getElementById('product-loader');
    const errorEl = document.getElementById('product-error');
    const contentEl = document.getElementById('product-content');
    
    const imgEl = document.getElementById('product-image');
    const nameEl = document.getElementById('product-name');
    const priceEl = document.getElementById('product-price');
    const shortDescEl = document.getElementById('product-short-desc');
    const longDescEl = document.getElementById('product-long-desc');
    const scentNotesEl = document.getElementById('product-scent-notes');
    const scentFamilyEl = document.getElementById('product-scent-family');
    const strengthEl = document.getElementById('product-strength');
    
    const quantityInput = document.getElementById('quantity');
    const cartButton = document.getElementById('add-to-cart-button');
    const cartConfirmation = document.getElementById('add-to-cart-confirmation');
    
    let currentProduct = null;

    /**
     * Fetches a single product from Firestore and populates the page.
     */
    async function loadProduct() {
        try {
            // 1. Get the product ID from the URL
            const params = new URLSearchParams(window.location.search);
            const productId = params.get('id');

            if (!productId) {
                // If no ID is provided, show an error
                showError();
                return;
            }

            // 2. Fetch the product document from Firestore
            const productRef = doc(db, 'products', productId);
            const docSnap = await getDoc(productRef);

            if (!docSnap.exists()) {
                // If the document doesn't exist, show an error
                showError();
                return;
            }

            // 3. We have the data!
            currentProduct = { id: docSnap.id, ...docSnap.data() };
            
            // 4. Populate the page with the data
            const placeholderImg = `https://placehold.co/600x600/FBF9F6/3D352E?text=${currentProduct.name.replace(' ', '+')}`;
            const imgSrc = currentProduct.imageUrl ? `/${currentProduct.imageUrl}` : placeholderImg;

            imgEl.src = imgSrc;
            imgEl.alt = `Photo of ${currentProduct.name}`;
            imgEl.onerror = () => { 
                imgEl.src = placeholderImg; 
                imgEl.onerror = null; 
            };

            nameEl.textContent = currentProduct.name;
            priceEl.textContent = `$${currentProduct.price}`;
            shortDescEl.textContent = currentProduct.shortDescription;
            
            // This is the key: we set the HTML content from the database.
            // This works because our "safe" filter is applied at the admin
            // level (or we trust the data).
            longDescEl.innerHTML = currentProduct.longDescription;
            
            scentNotesEl.textContent = currentProduct.scentNotes;
            scentFamilyEl.textContent = currentProduct.scentFamily;
            strengthEl.textContent = currentProduct.strength;

            // Update page title
            document.title = `${currentProduct.name} - Southern Sense`;

            // 5. Handle stock and "Add to Cart" button
            if (!currentProduct.stock || currentProduct.stock === 0) {
                cartButton.textContent = 'Out of Stock';
                cartButton.disabled = true;
                quantityInput.disabled = true;
            } else {
                cartButton.disabled = false;
                cartButton.addEventListener('click', handleAddToCart);
            }

            // 6. Show the content
            showContent();

        } catch (error) {
            console.error("Error loading product:", error);
            showError();
        }
    }

    /**
     * Handles the click event for the "Add to Cart" button.
     */
    function handleAddToCart() {
        const quantity = parseInt(quantityInput.value, 10);

        if (!currentProduct || quantity <= 0) {
            return;
        }

        // Create the item object to be added to the cart
        const cartItem = {
            id: currentProduct.id,
            name: currentProduct.name,
            price: currentProduct.price,
            imageUrl: currentProduct.imageUrl,
            quantity: quantity,
        };
        
        // Call the imported function from cart.js
        addToCart(cartItem);

        // Show confirmation message
        cartButton.textContent = 'Added!';
        cartConfirmation.classList.remove('hidden');

        // Reset button after 2 seconds
        setTimeout(() => {
            cartButton.textContent = 'Add to Cart';
            cartConfirmation.classList.add('hidden');
        }, 2000);
    }

    function showContent() {
        loader.classList.add('hidden');
        errorEl.classList.add('hidden');
        contentEl.classList.remove('hidden');
    }

    function showError() {
        loader.classList.add('hidden');
        errorEl.classList.remove('hidden');
        contentEl.classList.add('hidden');
    }

    // Load the product as soon as the DOM is ready
    document.addEventListener('DOMContentLoaded', loadProduct);

</script>
