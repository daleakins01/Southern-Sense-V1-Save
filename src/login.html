---
layout: layout.html
title: "Login"
---

<main class="container mx-auto px-4 py-16">
  <div class="max-w-md mx-auto">
    <h1 class="font-playfair text-4xl font-bold text-charcoal text-center">
      Customer Login
    </h1>
    <p class="text-stone text-center mt-4">
      Access your account and order history.
    </p>

    <!-- (Pillar 1): This is the Customer Auth epic.
         - This form will handle login.
         - We will add a "Forgot Password" link.
    -->

    <form id="login-form" class="mt-10 space-y-6">
      <div>
        <label for="email" class="block text-sm font-medium text-charcoal">
          Email Address
        </label>
        <input
          type="email"
          id="email"
          name="email"
          required
          class="mt-1 block w-full px-4 py-3 border border-stone/30 rounded-lg shadow-sm focus:outline-none focus:ring-burnt-orange focus:border-burnt-orange"
        />
      </div>

      <div>
        <label
          for="password"
          class="block text-sm font-medium text-charcoal"
        >
          Password
        </label>
        <input
          type="password"
          id="password"
          name="password"
          required
          class="mt-1 block w-full px-4 py-3 border border-stone/30 rounded-lg shadow-sm focus:outline-none focus:ring-burnt-orange focus:border-burnt-orange"
        />
      </div>

      <!-- Forgot Password Link -->
      <div class="text-right">
        <a
          href="#"
          id="forgot-password-link"
          class="text-sm text-stone hover:text-burnt-orange"
        >
          Forgot Password?
        </a>
      </div>

      <!-- Error Message -->
      <p id="error-message" class="text-red-600 text-center hidden"></p>
      <p id="reset-message" class="text-green-600 text-center hidden"></p>

      <!-- Login Button -->
      <div>
        <button
          type="submit"
          id="login-button"
          class="w-full bg-burnt-orange text-white font-roboto px-8 py-4 rounded-md shadow-lg hover:bg-opacity-90 transition-all duration-300 text-lg font-medium"
        >
          Login
        </button>
      </div>
    </form>

    <!-- Register Link -->
    <div class="mt-8 text-center">
      <p class="text-stone">
        New to Southern Sense?
        <a
          href="/register.html"
          class="font-medium text-burnt-orange hover:underline"
        >
          Create an account
        </a>
      </p>
    </div>
  </div>
</main>

<script type="module">
  import {
    auth,
    signInWithEmailAndPassword,
    sendPasswordResetEmail,
  } from "/src/auth.js";

  const loginForm = document.getElementById("login-form");
  const loginButton = document.getElementById("login-button");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const errorMessage = document.getElementById("error-message");
  const resetMessage = document.getElementById("reset-message");
  const forgotPasswordLink = document.getElementById("forgot-password-link");

  loginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    loginButton.disabled = true;
    loginButton.textContent = "Logging in...";
    errorMessage.classList.add("hidden");
    resetMessage.classList.add("hidden");

    const email = emailInput.value;
    const password = passwordInput.value;

    signInWithEmailAndPassword(auth, email, password)
      .then((userCredential) => {
        // Signed in
        const user = userCredential.user;
        // Redirect to account page or homepage
        window.location.href = "/account.html";
      })
      .catch((error) => {
        const errorCode = error.code;
        let msg = "An error occurred. Please try again.";
        if (
          errorCode === "auth/user-not-found" ||
          errorCode === "auth/wrong-password" ||
          errorCode === "auth/invalid-credential"
        ) {
          msg = "Invalid email or password. Please try again.";
        }
        console.error("Login Error:", error.code, error.message);
        errorMessage.textContent = msg;
        errorMessage.classList.remove("hidden");
        loginButton.disabled = false;
        loginButton.textContent = "Login";
      });
  });

  forgotPasswordLink.addEventListener("click", (e) => {
    e.preventDefault();
    const email = emailInput.value;
    if (!email) {
      errorMessage.textContent =
        "Please enter your email address above to reset your password.";
      errorMessage.classList.remove("hidden");
      resetMessage.classList.add("hidden");
      return;
    }

    errorMessage.classList.add("hidden");
    resetMessage.textContent = "Sending password reset email...";
    resetMessage.classList.remove("hidden");

    sendPasswordResetEmail(auth, email)
      .then(() => {
        resetMessage.textContent =
          "Password reset email sent! Check your inbox.";
      })
      .catch((error) => {
        console.error("Forgot Password Error:", error);
        errorMessage.textContent =
          "Error sending password reset email. Please check the address and try again.";
        errorMessage.classList.remove("hidden");
        resetMessage.classList.add("hidden");
      });
  });
</script>
